"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _react=_interopRequireWildcard(require("react")),_jquery=_interopRequireDefault(require("jquery"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(a){return a?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(d){for(var a=1;a<arguments.length;a++){var b=arguments[a];for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(d[c]=b[c])}return d}).apply(this,arguments)}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}require("./index.css");let aioButtonContext=(0,_react.createContext)();class Radio extends _react.Component{render(){let{className:a,justify:b,rtl:c,style:d,gap:g}=this.context;var{options:e=[],attrs:f={}}=this.props;return _react.default.createElement("div",_extends({},f,{className:"r-radio-button"+(c?" rtl":"")+(a?" "+a:""),style:{justifyContent:b?"center":void 0,...d}}),e.map((b,a)=>_react.default.createElement(Option,_extends({key:a},b,{renderIndex:a,gap:g,rtl:c}))))}}_defineProperty(Radio,"contextType",aioButtonContext);class AIOButton extends _react.Component{constructor(a){super(a),this.activeIndex=!1,this.state={open:this.props.open||!1,touch:"ontouchstart"in document.documentElement}}getPropfromProps({option,index,field}){let prop=this.props["option"+field[0].toUpperCase()+field.slice(1,field.length)],value;if("string"==typeof prop)try{eval("value = "+prop)}catch{value=void 0}else"function"==typeof prop?value=prop(option,index):void 0!==prop&&(value=prop);return value}getProp({option:d,index:g,field:e,def:h,type:a,readFrom:f}){if("props"!==f){let b=d[e];if(void 0!==b&&(!a||this.getType(b)===a))return b}if("option"!==f){let c=this.getPropfromProps({option:d,index:g,field:e});if(void 0!==c&&(!a||this.getType(c)===a))return c}return h}getType(a){return"object"==typeof a?Array.isArray(a)?"array":"object":typeof a}dragStart(a){this.dragIndex=parseInt((0,_jquery.default)(a.target).attr("datarealindex"))}dragOver(a){a.preventDefault()}drop(b){b.stopPropagation();let{onSwap:e}=this.props,c=this.dragIndex,a=(0,_jquery.default)(b.target);if(a.hasClass("aio-button-option")||(a=a.parents(".aio-button-option")),!a.hasClass("aio-button-option"))return;let d=parseInt(a.attr("datarealindex"));c!==d&&e(c,d,this.swap)}swap(c,b,d){let a=c.map((a,b)=>(a._testswapindex=b,a)),e=a[b]._testswapindex;return a.splice(d,0,{...a[b],_testswapindex:!1}),a.filter(a=>a._testswapindex!==e)}arrow(f,g,e){f.preventDefault();let b=g.find(".aio-button-option"),c=b.filter(".active");if(0===c.length){let d=b.eq(0),h=+d.attr("datarealindex"),i=+d.attr("datarenderindex");this.activeIndex={real:h,render:i},d.addClass("active")}else{let j=+c.attr("datarealindex"),a=+c.attr("datarenderindex");a+=e,console.log(a,b.length),1===e?a>=b.length&&(a=0):a<0&&(a=b.length-1),b.removeClass("active"),this.activeIndex={real:j,render:a},b.eq(a).addClass("active").focus()}}enter(a){!1!==this.activeIndex&&this.optionClick(this.props.options[this.activeIndex.real],a)}keyDown(a,b){40===a.keyCode?this.arrow(a,b,1):38===a.keyCode?this.arrow(a,b,-1):13===a.keyCode?this.enter(a):27===a.keyCode&&this.toggle()}optionClick(a,b){this.getProp({option:a,index:b,field:"disabled"})||(a.onClick?a.onClick(a,b):this.props.onClick&&this.props.onClick(a),!1!==this.getProp({option:a,index:b,field:"close",def:!0})&& void 0===this.getProp({option:a,index:b,field:"checked",def:void 0})&&this.toggle())}onButtonClick(a){if(0===(0,_jquery.default)(a.target).parents(".aio-button-tags").length){var{options:b,popOver:c,onClick:d=()=>{}}=this.props;b||c?this.toggle(!0):d(this.props)}}showPopup(c,b){let{popOver:d,type:a}=this.props;return"radio"!==a&&"checkbox"!==a&&"checklist"!==a&&!!c&&(!!d|| !!b&&!!b.length)}toggle(a,c){let{open:b}=this.state,{onBackdropClick:d,onToggle:e}=this.props;void 0===a&&(a=!b),clearTimeout(this.timeOut),this.timeOut=setTimeout(()=>{a!==b&&(this.setState({open:a}),a?(0,_jquery.default)("body").addClass("aio-button-open"):(0,_jquery.default)("body").removeClass("aio-button-open"),d&&c&&d(this.props),e&&e(a))},100)}getOptions(){let{options:m,type:c="button",text:t}=this.props;if("button"===c||"checkbox"===c||"select"===c&&t&&!this.state.open)return;this.tags=[],this.text=void 0;let n=[];for(let a=0;a<m.length;a++){let b=m[a],f=this.getProp({option:b,index:a,field:"value",def:void 0});if(void 0===f)continue;let o=this.getProp({option:b,index:a,field:"text",def:void 0}),d,i,e,g,j,k,h;"select"===c?(e="aio-button-option",d=this.getProp({option:b,index:a,field:"checked",def:void 0}),f===this.props.value&& void 0===this.text&&(this.text=o),j=this.getProp({option:b,index:a,field:"before",def:void 0}),k=this.getProp({option:b,index:a,field:"after",def:void 0}),g=!1,h=this.getProp({option:b,index:a,field:"close",def:void 0===d})):"multiselect"===c?(e="aio-button-option",d=-1!==(this.props.value||[]).indexOf(f),i=this.getProp({option:b,index:a,field:"tagAttrs",def:i}),j=this.getProp({option:b,index:a,field:"before",def:void 0}),k=this.getProp({option:b,index:a,field:"after",def:void 0}),g=!1,h=this.getProp({option:b,index:a,field:"close",def:void 0===d})):"radio"===c?(e="r-radio-button-option",d=this.props.value===f,g=!0,h=!1):"checklist"===c&&(e="r-radio-button-option",d=!0===f,g=!1,h=!1);let p=this.getProp({option:b,index:a,field:"show",def:!0});if(!p)continue;let u=this.getProp({option:b,index:a,field:"checkIcon",def:void 0}),v=this.getProp({option:b,index:a,field:"iconColor",def:void 0}),w=this.getProp({option:b,index:a,field:"iconSize",def:void 0}),x=this.getProp({option:b,index:a,field:"subtext",def:void 0}),q=this.getProp({option:b,index:a,field:"disabled",def:!1})||this.props.disabled,y=this.getProp({option:b,index:a,field:"attrs",def:{}}),r=this.getProp({option:b,index:a,field:"className",readFrom:"option",def:void 0}),s=this.getProp({option:b,index:a,field:"className",readFrom:"props",def:void 0});r&&(e+=" "+r),s&&(e+=" "+s),q&&(e+=" disabled");let z=this.getProp({option:b,index:a,field:"style",readFrom:"option",def:{}}),A={...this.getProp({option:b,index:a,field:"style",readFrom:"props",def:{}}),...z},l={option:b,value:f,show:p,text:o,subtext:x,checked:d,close:h,before:j,after:k,disabled:q,attrs:y,className:e,style:A,realIndex:a,tagAttrs:i,iconColor:v,iconSize:w,checkIcon:u,round:g};l.onClick=()=>{!l.disabled&&(b.onClick?b.onClick(l):b.onChange?b.onChange(f,l):"select"===c||"radio"===c?this.props.onChange(f,l):"multiselect"===c&&(-1===this.props.value.indexOf(f)?this.props.onChange(this.props.value.concat(f),f,"add"):this.props.onChange(this.props.value.filter(a=>a!==f),f,"remove")),h&& void 0===d&&this.toggle())},n.push(l),"multiselect"===c&&d&&this.tags.push(l)}return n}getText(){let{type:b,text:a}=this.props;return"select"===b?"function"==typeof a?a(this.text):void 0===a?this.text:a:"button"===b||"multiselect"===b?"function"==typeof a?a():a:void 0}getSubtext(){let{type:b,subtext:a,value:c}=this.props;return"button"===b?"function"==typeof a?a():a:"select"===b||"multiselect"===b?"function"==typeof a?a(c):a:void 0}render(){let{type:a,popOver:g,caret:b,className:l,style:h}=this.props,{open:i,touch:j}=this.state,k={...this.props,touch:j,optionClick:this.optionClick.bind(this),onButtonClick:this.onButtonClick.bind(this),toggle:this.toggle.bind(this),dragStart:this.dragStart.bind(this),dragOver:this.dragOver.bind(this),drop:this.drop.bind(this),keyDown:this.keyDown.bind(this)},c="aiobutton"+Math.round(1e7*Math.random()),d=this.getOptions(),e=this.getText(),f=this.getSubtext();return _react.default.createElement(aioButtonContext.Provider,{value:k},"multiselect"===a&&_react.default.createElement(Multiselect,{dataUniqId:c,tags:this.tags,text:e,subtext:f,caret:void 0===b||b,style:h}),"button"===a&&_react.default.createElement(Button,{dataUniqId:c,text:e,subtext:f,caret:void 0===b?!!g:b}),"select"===a&&_react.default.createElement(Button,{dataUniqId:c,text:e,subtext:f,caret:void 0===b||b}),("radio"===a||"checklist"===a)&&_react.default.createElement(Radio,{options:d}),"checkbox"===a&&_react.default.createElement(Checkbox,this.props),this.showPopup(i,d)&&_react.default.createElement(Popup,{dataUniqId:c,options:d}))}}exports.default=AIOButton,AIOButton.defaultProps={gap:6};class Checkbox extends _react.Component{getText(){let{text:a}=this.props;return"function"==typeof a?a():a}getSubtext(){let{subtext:a}=this.props;return"function"==typeof a?a():a}render(){let{className:a,disabled:b,onChange:f,value:c,gap:d,rtl:e}=this.props;return _react.default.createElement(Option,_extends({},this.props,{gap:d,rtl:e,text:this.getText(),subtext:this.getSubtext(),className:"r-radio-button-option"+(b?" disabled":"")+(a?" "+a:""),checked:!!c,onClick:()=>{b||f(!!c,this.props)},round:!1}))}}class Button extends _react.Component{render(){let{onButtonClick:g,before:a,gap:b,attrs:h={},rtl:i,caretAttrs:j,badge:c,badgeAttrs:k,after:d,disabled:l,className:e,style:m}=this.context,{dataUniqId:n,text:o,subtext:p,caret:f}=this.props,q={...h,style:m,tabIndex:0,onClick:g,"data-uniq-id":n,disabled:l,className:`aio-button ${i?"rtl":"ltr"}${e?" "+e:""}`};return _react.default.createElement("button",q,void 0!==a&&_react.default.createElement(Before,{before:a,gap:b}),_react.default.createElement(Text,{text:o,subtext:p}),!1!==f&&_react.default.createElement(Caret,{caret:f,attrs:j}),void 0!==d&&_react.default.createElement(After,{after:d,gap:b}),void 0!==c&&_react.default.createElement(Badge,{badge:c,attrs:k}))}}function Text(props){return _react.default.createElement("div",{className:"aio-button-text"},void 0!==props.text&&props.text,void 0!==props.subtext&&_react.default.createElement("div",{className:"r-radio-button-subtext"},props.subtext))}function Before(props){return _react.default.createElement(_react.default.Fragment,null,props.before,_react.default.createElement("div",{className:"aio-button-gap",style:{width:props.gap}}))}function Caret(props){let{attrs={}}=props,icon=!0===props.caret?_react.default.createElement("div",_extends({className:"aio-button-caret"},attrs)):props.caret;return _react.default.createElement(_react.default.Fragment,null,_react.default.createElement("div",{style:{flex:1}}),icon)}function After(props){return _react.default.createElement(_react.default.Fragment,null,_react.default.createElement("div",{style:{flex:1,minWidth:props.gap}}),props.after)}function Badge({badge,attrs={}}){return _react.default.createElement("div",_extends({},attrs,{className:"aio-button-badge"+(attrs.className?" "+attrs.className:"")}),badge)}function SearchBox(props){return _react.default.createElement("div",{className:"aio-button-search"},_react.default.createElement("div",{className:"aio-button-icon",onClick(){props.onChange("")}},props.value&&_react.default.createElement("svg",{viewBox:"0 0 24 24",role:"presentation",style:{width:"1.2rem",height:"1.2rem"}},_react.default.createElement("path",{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z",style:{fill:"currentcolor"}})),!props.value&&_react.default.createElement("svg",{viewBox:"0 0 24 24",role:"presentation",style:{width:"1.2rem",height:"1.2rem"}},_react.default.createElement("path",{d:"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z",style:{fill:"currentcolor"}}))),_react.default.createElement("input",{type:"text",value:props.value,placeholder:props.placeholder,onChange:a=>props.onChange(a.target.value)}))}function AddBox(props){return props.exact?null:_react.default.createElement("div",{className:"aio-button-add",onClick(){props.onClick()}},props.placeholder)}_defineProperty(Button,"contextType",aioButtonContext);class Popup extends _react.Component{constructor(a){super(a),this.dom=(0,_react.createRef)(),this.state={searchValue:"",addValue:""}}componentDidMount(){this.update((0,_jquery.default)(this.dom.current))}getLimit(a){var b=a.offset(),c=b.left-window.pageXOffset,d=b.top-window.pageYOffset,e=a.outerWidth(),f=a.outerHeight(),g=c+e,h=d+f;return{left:c,top:d,right:g,bottom:h,width:e,height:f}}update(e){let{dataUniqId:r}=this.props;var{rtl:s,openRelatedTo:n,animate:i,popupWidth:j,popupAttrs:t={},popupPosition:z}=this.context,u=(0,_jquery.default)(`.aio-button[data-uniq-id = ${r}]`),f=n?e.parents(n):void 0;f=Array.isArray(f)&&0===f.length?void 0:f;var k=window.innerWidth,l=window.innerHeight,a=f?this.getLimit(f):{left:0,top:0,right:k,bottom:l};a.left<0&&(a.left=0),a.right>k&&(a.right=k),a.top<0&&(a.top=0),a.bottom>l&&(a.bottom=l);var h,o,v,p,c=this.getLimit(u),d=this.getLimit(e),b={};p=(v=c.bottom)+d.height,j?(b.left=c.left,b.width="fit"===j?c.width:j):s?(h=(o=c.right)-d.width)<a.left?b.left=a.left:b.left=h:(o=(h=c.left)+d.width)>a.right?b.left=a.right-d.width:b.left=h,p>a.bottom?d.height>c.top-a.top?b.top=a.bottom-d.height:b.top=c.top-d.height:b.top=c.bottom;let q=t.style;if(i){let g={...b,...q},w=g.top+90,x=g.top,m;!0===i?(g.top=w,g.opacity=0,m={top:x,opacity:1}):m=i,e.css(g),e.animate(m,{duration:100})}else{let y={...b,...q};e.css(y)}e.focus()}getOptions(){let{searchValue:c}=this.state,{gap:h,dragStart:i,dragOver:j,drop:k,rtl:l,onSwap:m}=this.context,{options:d}=this.props,e=[],f=!1,g=0;for(let a=0;a<d.length;a++){let b=d[a];void 0!==b.text&&(!c|| -1!==b.text.indexOf(c))&&(b.text===c&&(f=!0),e.push(_react.default.createElement(Option,_extends({key:a},b,{renderIndex:g,gap:h,dragStart:i,dragOver:j,drop:k,rtl:l,onSwap:m}))),g++)}return this.exact=f,e}renderPopOver(){return this.context.popOver?this.context.popOver(this.context):null}renderOptions(){let{popOver:e,searchText:f="Search",addText:g="Add",search:h,popupHeader:c,popupFooter:d,onAdd:i}=this.context,{searchValue:a}=this.state;if(e)return null;let b=this.getOptions();return _react.default.createElement(_react.default.Fragment,null,c&&c,(""!==a||b.length>10)&& !1!==h&&_react.default.createElement(SearchBox,{value:a,onChange:a=>this.setState({searchValue:a}),placeholder:f}),i&&a&&_react.default.createElement(AddBox,{value:a,onClick:()=>i(a),placeholder:g,options:b,exact:this.exact}),_react.default.createElement("div",{className:"aio-button-options"},b),d&&d)}getClassName(){let{rtl:c,popupAttrs:d={}}=this.context,{className:b}=d,a="aio-button-popup";return c&&(a+=" rtl"),b&&(a+=" "+b),a}render(){var{toggle:e,popupAttrs:a={},keyDown:f,backColor:b}=this.context;let{dataUniqId:c}=this.props,d={className:"aio-button-popup-container",style:{background:b},onClick(a){a.stopPropagation(),(0,_jquery.default)(a.target).attr("data-uniq-id")===c||(0,_jquery.default)(a.target).parents(`[data-uniq-id=${c}]`).length||e(!1,!0)}};return _react.default.createElement("div",d,_react.default.createElement("div",_extends({},a,{ref:this.dom,"data-uniq-id":c,className:this.getClassName(),tabIndex:0,onKeyDown:a=>f(a,(0,_jquery.default)(this.dom.current))}),this.renderPopOver(),this.renderOptions()))}}_defineProperty(Popup,"contextType",aioButtonContext);class Multiselect extends _react.Component{render(){let{showTags:b,style:c={}}=this.context,{dataUniqId:d,tags:a,text:e,subtext:f,caret:g}=this.props;return _react.default.createElement("div",{className:"aio-button-multiselect",style:{width:c.width}},_react.default.createElement(Button,{dataUniqId:d,text:e,subtext:f,caret:g}),!1!==b&&0!==a.length&&_react.default.createElement(Tags,{tags:a}))}}_defineProperty(Multiselect,"contextType",aioButtonContext);class Tags extends _react.Component{render(){let{tagsContainerClassName:a,tagsContainerStyle:b,rtl:c}=this.context,{tags:d}=this.props,e=d.map((a,b)=>_react.default.createElement(Tag,_extends({},a,{attrs:a.tagAttrs})));return _react.default.createElement("div",{className:"aio-button-tags"+(c?" rtl":"")+(a?" "+a:""),style:b},e)}}function Tag(props){let{text,onClick,disabled,attrs={},before=_react.default.createElement("svg",{viewBox:"0 0 24 24",role:"presentation",style:{width:"0.9rem",height:"0.9rem"}},_react.default.createElement("path",{d:"M12,8A4,4 0 0,0 8,12A4,4 0 0,0 12,16A4,4 0 0,0 16,12A4,4 0 0,0 12,8Z",style:{fill:"currentcolor"}}))}=props;return _react.default.createElement("div",{className:"aio-button-tag"+(attrs.className?" "+attrs.className:"")+(disabled?" disabled":""),onClick:onClick,style:attrs.style},_react.default.createElement("div",{className:"aio-button-tag-icon"},before),_react.default.createElement("div",{className:"aio-button-tag-text"},text),_react.default.createElement("div",{className:"aio-button-tag-icon"},_react.default.createElement("svg",{viewBox:"0 0 24 24",role:"presentation",style:{width:"0.9rem"}},_react.default.createElement("path",{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z",style:{fill:"currentcolor"}}))))}function CheckIcon(props){let{checked,iconColor,iconSize,checkIcon,round,gap}=props;if(void 0===checked)return null;if(void 0!==checkIcon)return _react.default.createElement(_react.default.Fragment,null,checkIcon,_react.default.createElement("div",{className:"aio-button-gap",style:{width:gap}}));Array.isArray(iconColor)||(iconColor=[iconColor]);let[outerColor,innerColor=outerColor]=iconColor;iconColor=[outerColor,innerColor],Array.isArray(iconSize)||(iconSize=[]);let[outerSize,innerSize,stroke]=iconSize;return iconSize=[outerSize,innerSize,stroke],_react.default.createElement(_react.default.Fragment,null,_react.default.createElement("div",{className:"aio-button-check-out"+(checked?" checked":"")+(round?" round":""),style:{color:iconColor[0],width:iconSize[0],height:iconSize[0],border:`${iconSize[2]}px solid`}},checked&&_react.default.createElement("div",{className:"aio-button-check-in"+(round?" round":""),style:{background:iconColor[1],width:iconSize[1],height:iconSize[1]}})),_react.default.createElement("div",{className:"aio-button-gap",style:{width:gap}}))}_defineProperty(Tags,"contextType",aioButtonContext);class Option extends _react.Component{render(){let{option:b,realIndex:f,renderIndex:g,checked:h,before:d,after:e,text:i,subtext:j,className:k,style:l,onClick:m,title:n,round:o=!0,iconSize:p,iconColor:q,checkIcon:r,gap:c=6,dragStart:s,dragOver:t,drop:u,rtl:v,onSwap:w}=this.props,a={className:k,title:n,style:l,onClick:m,datarenderindex:g,datarealindex:f,tabIndex:0},x={checked:h,iconColor:q,iconSize:p,checkIcon:r,round:o,gap:c};return w&&(a.onDragStart=s,a.onDragOver=t,a.onDrop=u,a.draggable=!0),_react.default.createElement(_react.default.Fragment,null,b&&b.splitter&&_react.default.createElement("div",{className:"aio-button-splitter "+(v?"rtl":"ltr")},b.splitter),_react.default.createElement("div",a,_react.default.createElement(CheckIcon,x),d&&_react.default.createElement(Before,{before:d,gap:c}),_react.default.createElement(Text,{text:i,subtext:j}),e&&_react.default.createElement(After,{after:e,gap:c})))}}